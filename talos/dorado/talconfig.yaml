# https://budimanjojo.github.io/talhelper/latest/
# yaml-language-server: $schema=https://raw.githubusercontent.com/budimanjojo/talhelper/refs/heads/master/pkg/config/schemas/talconfig.json

clusterName: &cluster dorado
endpoint: https://10.243.2.222:6443
allowSchedulingOnControlPlanes: true

talosVersion: "v1.10.2"
kubernetesVersion: "v1.33.1"

clusterPodNets:
  - 100.64.0.0/16
  - fd86:d8e7:4cef::/48
clusterSvcNets:
  - 100.80.0.0/12
  - fd86:3864:ad47::/112

nodes:
  - hostname: m1
    controlPlane: true
    ipAddress: 10.243.2.222
    installDisk: /dev/sd0
    networkInterfaces:
      - interface: eth0
        addresses:
          - 10.243.2.222/24
        routes:
          - network: 0.0.0.0/0
            gateway: 10.243.2.254
    machineSpec:
      mode: metal
      arch: arm64
    schematic:
      overlay:
        name: orangepi-5-plus
        image: siderolabs/sbc-rockchip
  - hostname: m2
    controlPlane: true
    ipAddress: 10.243.2.223
    installDisk: /dev/sd0
    networkInterfaces:
      - interface: eth0
        addresses:
          - 10.243.2.223/24
        routes:
          - network: 0.0.0.0/0
            gateway: 10.243.2.254
    machineSpec:
      mode: metal
      arch: arm64
    schematic:
      overlay:
        name: orangepi-5-plus
        image: siderolabs/sbc-rockchip
  - hostname: m3
    controlPlane: true
    ipAddress: 10.243.2.224
    installDisk: /dev/sd0
    networkInterfaces:
      - interface: eth0
        addresses:
          - 10.243.2.224/24
        routes:
          - network: 0.0.0.0/0
            gateway: 10.243.2.254
    machineSpec:
      mode: metal
      arch: arm64
    schematic:
      overlay:
        name: orangepi-5-plus
        image: siderolabs/sbc-rockchip

controlPlane:
  nodeLabels:
    topology.kubernetes.io/region: Paris
    topology.kubernetes.io/zone: *cluster
  schematic:
    customization:
      systemExtensions:
        officialExtensions:
          - "siderolabs/lldpd"
          - "siderolabs/nvme-cli"
          - "siderolabs/util-linux-tools"
          - "siderolabs/iscsi-tools"

patches:
  - |-
    cluster:
      network:
        cni:
          name: none
      proxy:
        disabled: true
    machine:
      kubelet:
        extraArgs:
          rotate-server-certificates: true
      network:
        kubespan:
          enabled: false
        nameservers:
          - 10.243.3.254
          - 10.241.2.254
